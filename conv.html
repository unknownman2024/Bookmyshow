import json
from datetime import datetime

def parse_ticket_sales(data, release_date):
    release_date_obj = datetime.strptime(release_date, "%d.%m.%y")
    ticket_sales = []
    
    for entry in data:
        day, date, _, no_of_tickets, total, day_after, date_after, no_of_tickets_after, total_after = entry
        
        # Normalize values
        no_of_tickets = no_of_tickets.replace(" ", "")
        total = total.replace(" ", "")
        no_of_tickets_after = no_of_tickets_after.replace(" ", "")
        total_after = total_after.replace(" ", "")
        
        date_obj = datetime.strptime(date, "%d.%m.%y")
        days_before_release = (release_date_obj - date_obj).days if date_obj < release_date_obj else None
        
        date_after_obj = datetime.strptime(date_after, "%d.%m.%y")
        days_after_release = (date_after_obj - release_date_obj).days + 1 if date_after_obj >= release_date_obj else None
        
        if days_before_release is not None:
            ticket_sales.append({
                "date": date,
                "no_of_tickets": no_of_tickets,
                "total": total,
                "days_before_release": days_before_release
            })
        
        if days_after_release is not None:
            ticket_sales.append({
                "date": date_after,
                "no_of_tickets": no_of_tickets_after,
                "total": total_after,
                "days_after_release": days_after_release
            })
    
    # Sort data: descending for days_before_release, ascending for days_after_release
    ticket_sales.sort(key=lambda x: (x.get("days_before_release", float("inf")), x.get("days_after_release", -float("inf"))), reverse=True)
    
    return ticket_sales

# Example input data
data = [
    (5, "10.08.24", "SAT", "47 K", "47 K", 27, "10.09.24", "47 K", "9788 K"),
    (4, "11.08.24", "SUN", "81 K", "128 K", 28, "11.09.24", "44 K", "9833 K"),
]

release_date = "15.08.24"

output = {
    "movie_name": "Stree 2",
    "release_date": "2024-08-15",
    "poster": "https://assets-in.bmscdn.com/iedb/movies/images/mobile/thumbnail/xlarge/stree-2-et00312345-1737184762.jpg",
    "peak_hour": "7 PM - 9 PM",
    "ticket_sales": parse_ticket_sales(data, release_date)
}

print(json.dumps(output, indent=4))
